<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Status Giliran</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshQueue()">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <!-- Alert Notification -->
  <div class="alert-notification" *ngIf="showAlert" [@slideDown]>
    <ion-icon name="notifications"></ion-icon>
    <span>{{alertMessage}}</span>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Memuatkan status giliran...</p>
  </div>

  <div class="content-wrapper" *ngIf="!loading">

    <!-- Main Status Card -->
    <ion-card class="main-status-card" [class.pulse]="pulseAnimation">
      <ion-card-content>

        <!-- Your Queue Number -->
        <div class="queue-number-section">
          <p class="label">Nombor Giliran Anda</p>
          <h1 class="queue-number">{{myQueue.queueNumber}}</h1>
          <ion-badge [color]="getStatusColor(myQueue.status)">
            {{getStatusText(myQueue.status)}}
          </ion-badge>
        </div>

        <div class="divider"></div>

        <!-- Current Serving -->
        <div class="serving-section">
          <p class="label">Sedang Dilayan</p>
          <h2 class="serving-number">{{myQueue.currentServing}}</h2>
        </div>

        <div class="divider"></div>

        <!-- Info Grid -->
        <div class="info-grid">
          <div class="info-item">
            <ion-icon name="people" color="primary"></ion-icon>
            <div>
              <p class="value">{{myQueue.peopleAhead}}</p>
              <p class="label">Orang di hadapan</p>
            </div>
          </div>
          <div class="info-item">
            <ion-icon name="time" color="primary"></ion-icon>
            <div>
              <p class="value">~{{myQueue.estimatedWaitTime}} min</p>
              <p class="label">Anggaran masa</p>
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
          <div class="progress-info">
            <span>Kemajuan Giliran</span>
            <span class="percentage">{{getProgressPercentage()}}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
          </div>
        </div>

      </ion-card-content>
    </ion-card>

    <!-- Clinic Info -->
    <ion-card class="clinic-info-card">
      <ion-card-header>
        <ion-card-title>Maklumat Klinik</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="clinic-details">
          <div class="detail-item">
            <ion-icon name="business" color="primary"></ion-icon>
            <span>{{myQueue.clinicName}}</span>
          </div>
          <div class="detail-item" (click)="viewClinicLocation()">
            <ion-icon name="location" color="primary"></ion-icon>
            <span>{{myQueue.clinicAddress}}</span>
            <ion-icon name="chevron-forward" color="medium"></ion-icon>
          </div>
          <div class="detail-item">
            <ion-icon name="time" color="primary"></ion-icon>
            <span>Check-in: {{myQueue.checkInTime}}</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Queue List -->
    <div class="queue-list-section">
      <h3>Senarai Giliran</h3>

      <div class="queue-list">
        <div *ngFor="let queue of queueList" class="queue-item" [class.completed]="queue.status === 'completed'"
          [class.serving]="queue.status === 'serving'" [class.my-queue]="isMyQueue(queue.number)"
          [class.waiting]="queue.status === 'waiting'">
          <div class="queue-item-number">
            <span>{{queue.number}}</span>
            <ion-icon *ngIf="isMyQueue(queue.number)" name="person" color="primary"></ion-icon>
          </div>

          <div class="queue-item-status">
            <ion-icon *ngIf="queue.status === 'completed'" name="checkmark-circle" color="success"></ion-icon>
            <ion-icon *ngIf="queue.status === 'serving'" name="radio-button-on" color="success"
              class="blink"></ion-icon>
            <ion-icon *ngIf="queue.status === 'waiting'" name="ellipse-outline" color="medium"></ion-icon>

            <span>{{getStatusText(queue.status)}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="action-buttons">
      <ion-button expand="block" fill="outline" color="danger" (click)="cancelQueue()">
        <ion-icon slot="start" name="close-circle"></ion-icon>
        Batalkan Giliran
      </ion-button>
    </div>

    <!-- Tips -->
    <ion-card class="tips-card">
      <ion-card-content>
        <h4>ðŸ’¡ Tips</h4>
        <ul>
          <li>Anda akan menerima notifikasi bila giliran hampir tiba</li>
          <li>Sila berada di kawasan klinik apabila giliran anda dipanggil</li>
          <li>Jika terlepas giliran, sila maklumkan kepada kaunter</li>
        </ul>
      </ion-card-content>
    </ion-card>

  </div>

</ion-content>